<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>IndoMY Community Portal</title>
  <style>
    :root { --primary:#FF6B6B; --secondary:#4ECDC4; --dark:#2C3E50; --light:#F7F9FC; }
    * { box-sizing:border-box; margin:0; padding:0; font-family: 'Inter', system-ui, -apple-system, sans-serif; }
    body { background:#f0f2f5; color:var(--dark); }
    nav { background:#fff; padding:1rem 5%; display:flex; justify-content:space-between; align-items:center; box-shadow:0 2px 10px rgba(0,0,0,0.1); position: sticky; top:0; z-index:999; }
    nav .logo { font-weight:800; font-size:1.5rem; color:var(--primary); text-decoration:none; }
    nav a { margin-left:1.5rem; text-decoration:none; color:var(--dark); font-weight:500; }
    .container { max-width:1200px; margin:2rem auto; padding:0 1rem; }

    .featured-hero{ background:linear-gradient(rgba(0,0,0,.5),rgba(0,0,0,.7)),url('https://images.unsplash.com/photo-1517433447755-d1491d681b59?auto=format&fit=crop&w=1200&q=80'); background-size:cover; background-position:center; border-radius:20px; padding:5rem 3rem; color:#fff; margin-bottom:3rem; }
    .section-title{ margin:2rem 0 1.5rem; font-size:1.8rem; border-left:6px solid var(--primary); padding-left:1rem; }
    .grid{ display:grid; grid-template-columns: repeat(auto-fill, minmax(300px,1fr)); gap:2rem; }
    .card{ background:#fff; border-radius:15px; overflow:hidden; box-shadow:0 4px 15px rgba(0,0,0,0.05); transition:.3s; }
    .card:hover{ transform:translateY(-5px); }
    .card-img{ width:100%; height:200px; object-fit:cover; }
    .card-body{ padding:1.25rem; }
    .category-badge{ background:var(--secondary); color:#fff; padding:.2rem .8rem; border-radius:20px; font-size:.8rem; display:inline-block; margin-bottom:.5rem; }
    .contact-card{ border-top:4px solid var(--primary); }
    .stars { color:#f5a623; font-size:1rem; margin:.25rem 0 .5rem; }
    .btn{ display:inline-block; margin-top:.5rem; background:var(--primary); color:#fff; padding:.5rem .9rem; border-radius:10px; text-decoration:none; font-weight:600; }
    .muted{ color:#667; font-size:.9rem; }
  </style>
</head>
<body>
  <nav>
    <a href="index.html" class="logo">IndoMY</a>
    <div>
      <a href="submit-article.html">Post Article</a>
      <a href="submit.html">Add Service</a>
      <a href="about.html">About</a>
    </div>
  </nav>

  <div class="container">
    <div id="featured-article" class="featured-hero">
      <div class="category-badge">Featured</div>
      <h1 id="hero-title">Loading...</h1>
      <p id="hero-desc">Checking for community updates...</p>
    </div>

    <h2 class="section-title">Guides & Articles</h2>
    <div id="articles-grid" class="grid"></div>

    <h2 class="section-title">Service Directory</h2>
    <div id="contacts-grid" class="grid"></div>
  </div>

  <script>
    async function fetchJSON(url) {
      const res = await fetch(url);
      if (!res.ok) throw new Error(await res.text());
      return res.json();
    }

    function renderStars(avg=0) {
      const full = Math.floor(avg);
      const half = (avg - full) >= 0.5 ? 1 : 0;
      const empty = 5 - full - half;
      return '★'.repeat(full) + (half ? '½' : '') + '☆'.repeat(empty);
    }

    async function init() {
      try {
        const featured = await fetchJSON('/api/articles?featured=1');
        const hero = document.getElementById('featured-article');
        if (featured.record) {
          const f = featured.record.fields;
          document.getElementById('hero-title').innerText = f.Title;
          document.getElementById('hero-desc').innerText = (f.Content || '').slice(0, 150) + '...';
          if (f.ImageURL) hero.style.backgroundImage = `linear-gradient(rgba(0,0,0,.5),rgba(0,0,0,.7)),url('${f.ImageURL}')`;
          hero.onclick = () => location.href = `article.html?slug=${encodeURIComponent(f.Slug)}`;
          hero.style.cursor = 'pointer';
        } else {
          document.getElementById('hero-title').innerText = 'Welcome to IndoMY Community';
          document.getElementById('hero-desc').innerText = 'Share services, read guides, and help each other.';
        }

        const arts = await fetchJSON('/api/articles');
        const agrid = document.getElementById('articles-grid');
        agrid.innerHTML = (arts.records || []).map(r => {
          const f = r.fields;
          const img = f.ImageURL || 'https://via.placeholder.com/400x200';
          return `
          <div class="card">
            <img src="${img}" class="card-img" alt="">
            <div class="card-body">
              <span class="category-badge">${f.Category || 'General'}</span>
              <h3>${f.Title}</h3>
              <p>${(f.Content || '').slice(0, 120)}...</p>
              <small class="muted">By ${f.Author || 'Anonymous'}</small><br/>
              <a class="btn" href="article.html?slug=${encodeURIComponent(f.Slug)}">Read</a>
            </div>
          </div>`;
        }).join('');

        const cons = await fetchJSON('/api/contacts');
        const cgrid = document.getElementById('contacts-grid');
        cgrid.innerHTML = (cons.records || []).map(r => {
          const f = r.fields;
          const stars = renderStars(f.AverageRating || 0);
          return `
          <div class="card contact-card">
            <div class="card-body">
              <span class="category-badge">${f.Category || ''}</span>
              <h3 style="color:var(--primary)">${f.Name}</h3>
              <div class="stars">${stars} <span class="muted">(${f.ReviewsCount||0})</span></div>
              <p><strong>${f.Area || 'All Malaysia'}</strong></p>
              <p>☎️ ${f.Phone || '-'}</p>
              <a class="btn" href="contact.html?id=${r.id}">View / Rate</a>
            </div>
          </div>`;
        }).join('');
      } catch (e) {
        console.error(e);
      }
    }
    init();
  </script>
</body>
</html>