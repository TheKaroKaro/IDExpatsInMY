<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IndoMY - Komunitas Indonesia di Malaysia</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <a href="/" class="logo">IndoMY</a>
            <div class="nav-links">
                <a href="services.html">Direktori Jasa</a>
                <a href="articles.html">Artikel</a>
                <a href="submit-service.html">Tambah Jasa</a>
                <a href="submit-article.html">Tulis Artikel</a>
            </div>
        </div>
    </nav>

    <section class="hero">
        <div class="container">
            <h1>Selamat Datang di IndoMY</h1>
            <p>Platform komunitas Indonesia di Malaysia. Temukan jasa terpercaya dan artikel bermanfaat.</p>
            <div class="hero-buttons">
                <a href="submit-service.html" class="btn btn-primary">Tambah Jasa</a>
                <a href="services.html" class="btn btn-outline">Cari Jasa</a>
            </div>
        </div>
    </section>

    <main class="container">
        <!-- Featured Article -->
        <section id="featured-article-section">
            <h2>Artikel Unggulan</h2>
            <div id="featured-article" class="featured-card">
                <p class="loading">Memuat...</p>
            </div>
        </section>

        <!-- Recent Articles -->
        <section>
            <div class="section-header">
                <h2>Artikel Terbaru</h2>
                <a href="articles.html" class="view-all">Lihat Semua ‚Üí</a>
            </div>
            <div id="recent-articles" class="grid grid-3">
                <p class="loading">Memuat...</p>
            </div>
        </section>

        <!-- Recent Services -->
        <section>
            <div class="section-header">
                <h2>Jasa Terbaru</h2>
                <a href="services.html" class="view-all">Lihat Semua ‚Üí</a>
            </div>
            <div id="recent-services" class="grid grid-3">
                <p class="loading">Memuat...</p>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2024 IndoMY - Komunitas Indonesia di Malaysia</p>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
    <script src="js/config.js"></script>
    <script src="js/supabase.js"></script>
    <script src="js/turnstile.js"></script>
    <script>
        // Load homepage data
        async function loadHomepage() {
            try {
                // Load featured article
                const featured = await ArticlesAPI.getFeatured();
                const featuredEl = document.getElementById('featured-article');
                
                if (featured) {
                    featuredEl.innerHTML = `
                        <img src="${featured.image_url || 'https://via.placeholder.com/800x400'}" alt="${featured.title}">
                        <div class="featured-content">
                            <h3>${featured.title}</h3>
                            <p>${featured.content.substring(0, 200)}...</p>
                            <a href="article-detail.html?slug=${featured.slug}" class="btn btn-small">Baca Selengkapnya</a>
                        </div>
                    `;
                } else {
                    featuredEl.innerHTML = '<p>Belum ada artikel unggulan.</p>';
                }
                
                // Load recent articles
                const articles = await ArticlesAPI.getApproved({ limit: 3 });
                const articlesEl = document.getElementById('recent-articles');
                
                if (articles.length > 0) {
                    articlesEl.innerHTML = articles.map(article => `
                        <div class="card">
                            <img src="${article.image_url || 'https://via.placeholder.com/400x200'}" alt="${article.title}">
                            <div class="card-body">
                                <h3><a href="article-detail.html?slug=${article.slug}">${article.title}</a></h3>
                                <p>${article.content.substring(0, 100)}...</p>
                                <small>Oleh ${article.author} ‚Ä¢ ${new Date(article.created_at).toLocaleDateString()}</small>
                            </div>
                        </div>
                    `).join('');
                } else {
                    articlesEl.innerHTML = '<p>Belum ada artikel.</p>';
                }
                
                // Load recent services
                const services = await ServicesAPI.getApproved({ limit: 3 });
                const servicesEl = document.getElementById('recent-services');
                
                if (services.length > 0) {
                    servicesEl.innerHTML = services.map(service => `
                        <div class="card">
                            <div class="card-body">
                                <span class="category">${service.category}</span>
                                <h3><a href="service-detail.html?id=${service.id}">${service.name}</a></h3>
                                <div class="rating">‚≠ê ${service.average_rating} (${service.reviews_count})</div>
                                <p>${service.description.substring(0, 100)}...</p>
                                <small>üìç ${service.area || 'Malaysia'}</small>
                            </div>
                        </div>
                    `).join('');
                } else {
                    servicesEl.innerHTML = '<p>Belum ada jasa.</p>';
                }
                
            } catch (error) {
                console.error('Error loading homepage:', error);
            }
        }
        
        loadHomepage();
    </script>
</body>
</html>