<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>IndoMY Admin Dashboard</title>
    <style>
        body { font-family: system-ui; padding: 20px; background: #f8f9fa; }
        .tab-nav { margin-bottom: 20px; }
        .tab-btn { padding: 10px 20px; cursor: pointer; border: none; background: #ddd; }
        .tab-btn.active { background: #2c3e50; color: white; }
        .admin-card { background: white; padding: 15px; margin-bottom: 10px; border-radius: 10px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .btn-approve { background: #2ecc71; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; }
        .btn-reject { background: #e74c3c; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; margin-left: 10px; }
        .featured-badge { background: #f1c40f; font-size: 10px; padding: 2px 5px; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>Admin Dashboard</h1>
    <div class="tab-nav">
        <button class="tab-btn active" onclick="loadTable('Articles')">Pending Articles</button>
        <button class="tab-btn" onclick="loadTable('Contacts')">Pending Contacts</button>
    </div>

    <div id="pending-list">Loading...</div>

    <script>
        const AIRTABLE_PAT = 'pat3F6y7NfN8f0NfN.your_token';
        const BASE_ID = 'appTSFC7saG9cxgHy';
        let currentTable = 'Articles';

        async function loadTable(table) {
            currentTable = table;
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            event?.target?.classList?.add('active');

            const list = document.getElementById('pending-list');
            list.innerHTML = "Fetching...";

            try {
                const res = await fetch(`https://api.airtable.com/v0/${BASE_ID}/${table}?filterByFormula={Status}='Pending'`, {
                    headers: { Authorization: `Bearer ${AIRTABLE_PAT}` }
                });
                const data = await res.json();
                
                if(data.records.length === 0) {
                    list.innerHTML = "<p>No pending submissions.</p>";
                    return;
                }

                list.innerHTML = data.records.map(r => `
                    <div class="admin-card">
                        <div>
                            <strong>${table === 'Articles' ? r.fields.Title : r.fields.Name}</strong><br>
                            <small>Code used: ${r.fields.AccessCode || 'NONE'}</small>
                        </div>
                        <div>
                            <button class="btn-approve" onclick="updateStatus('${r.id}', 'Approved')">Approve</button>
                            <button class="btn-reject" onclick="updateStatus('${r.id}', 'Rejected')">Reject</button>
                        </div>
                    </div>
                `).join('');
            } catch (err) { list.innerHTML = "Error loading data."; }
        }

        async function updateStatus(id, newStatus) {
            await fetch(`https://api.airtable.com/v0/${BASE_ID}/${currentTable}/${id}`, {
                method: 'PATCH',
                headers: {
                    'Authorization': `Bearer ${AIRTABLE_PAT}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ fields: { Status: newStatus } })
            });
            loadTable(currentTable);
        }

        loadTable('Articles');
    </script>
</body>
</html>