<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Service - IndoMY Community</title>
    <style>
        /* Same styles as index.html for consistency */
        :root {
            --primary: #FF6B6B;
            --secondary: #4ECDC4;
            --accent: #FFE66D;
            --dark: #2C3E50;
            --light: #F7F9FC;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .form-container {
            max-width: 600px;
            margin: 2rem auto;
            background: white;
            border-radius: 30px;
            padding: 2rem;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        .honeypot {
            display: none;
        }
        
        .form-header {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .form-header h1 {
            color: var(--primary);
            font-size: 2rem;
        }
        
        .form-header p {
            color: var(--gray);
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--dark);
        }
        
        .form-control {
            width: 100%;
            padding: 1rem;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .form-control:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(255, 107, 107, 0.1);
        }
        
        .btn-submit {
            background: linear-gradient(135deg, var(--primary), #ff8e8e);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
        }
        
        .btn-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(255, 107, 107, 0.3);
        }
        
        .btn-submit:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .alert {
            padding: 1rem;
            border-radius: 15px;
            margin-bottom: 1rem;
            display: none;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border-left: 5px solid #2ecc71;
        }
        
        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border-left: 5px solid #e74c3c;
        }
        
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin-right: 0.5rem;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="form-container">
        <div class="form-header">
            <h1>‚ûï Share a Service</h1>
            <p>Help fellow members find trusted services</p>
        </div>
        
        <div id="alert" class="alert"></div>
        
        <form id="submitForm">
            <!-- Honeypot field -->
            <div class="honeypot">
                <label for="website">Leave this empty</label>
                <input type="text" id="website" name="website">
            </div>
            
            <div class="form-group">
                <label for="name">Service/Business Name *</label>
                <input type="text" id="name" class="form-control" required>
            </div>
            
            <div class="form-group">
                <label for="category">Category *</label>
                <select id="category" class="form-control" required>
                    <option value="">Select category</option>
                    <option value="Money Changer">üí∞ Money Changer</option>
                    <option value="Locksmith">üîë Locksmith</option>
                    <option value="Driver">üöó Driver</option>
                    <option value="Car Rental">üöô Car Rental</option>
                    <option value="Restaurant">üçú Restaurant</option>
                    <option value="Grocery">üõí Grocery</option>
                    <option value="Travel Agent">‚úàÔ∏è Travel Agent</option>
                    <option value="Lawyer">‚öñÔ∏è Lawyer</option>
                    <option value="Doctor">üè• Doctor</option>
                    <option value="Contractor">üî® Contractor</option>
                    <option value="Other">Other</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="phone">Phone Number *</label>
                <input type="tel" id="phone" class="form-control" required placeholder="e.g., +60 12-345 6789">
            </div>
            
            <div class="form-group">
                <label for="whatsapp">WhatsApp Number (Optional)</label>
                <input type="tel" id="whatsapp" class="form-control" placeholder="e.g., +60 12-345 6789">
            </div>
            
            <div class="form-group">
                <label for="address">Address (Optional)</label>
                <textarea id="address" class="form-control" placeholder="Full address in Malaysia" rows="3"></textarea>
            </div>
            
            <div class="form-group">
                <label for="description">Description *</label>
                <textarea id="description" class="form-control" required placeholder="Tell us about this service..." rows="4"></textarea>
            </div>
            
            <div class="form-group">
                <label for="submittedBy">Your Name *</label>
                <input type="text" id="submittedBy" class="form-control" required>
            </div>
            
            <div class="form-group">
                <label>Anti-spam: What is 5 + 3? *</label>
                <input type="number" id="mathCheck" class="form-control" required>
            </div>
            
            <button type="submit" id="submitBtn" class="btn-submit">
                <span class="btn-text">Submit for Review</span>
                <span class="spinner" style="display: none;"></span>
            </button>
        </form>
    </div>
    
    <script>
        const AIRTABLE_PAT = 'YOUR_AIRTABLE_PAT';
        const AIRTABLE_BASE_ID = 'appTSFC7saG9cxgHy';
        
        document.getElementById('submitForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const alertDiv = document.getElementById('alert');
            const submitBtn = document.getElementById('submitBtn');
            const btnText = submitBtn.querySelector('.btn-text');
            const spinner = submitBtn.querySelector('.spinner');
            
            alertDiv.style.display = 'none';
            
            // Honeypot check
            if (document.getElementById('website').value) {
                console.log('Bot detected');
                return;
            }
            
            // Math check
            const mathAnswer = parseInt(document.getElementById('mathCheck').value);
            if (mathAnswer !== 8) {
                alertDiv.className = 'alert alert-error';
                alertDiv.style.display = 'block';
                alertDiv.textContent = '‚ùå Incorrect anti-spam answer. Please try again.';
                return;
            }
            
            // Show loading state
            submitBtn.disabled = true;
            btnText.textContent = 'Submitting...';
            spinner.style.display = 'inline-block';
            
            const fields = {
                Name: document.getElementById('name').value,
                Category: document.getElementById('category').value,
                Phone: document.getElementById('phone').value,
                SubmittedBy: document.getElementById('submittedBy').value,
                Description: document.getElementById('description').value,
                Status: 'Pending',
                Rating: 0,
                CreatedAt: new Date().toISOString().split('T')[0]
            };
            
            if (document.getElementById('whatsapp').value) {
                fields.WhatsApp = document.getElementById('whatsapp').value;
            }
            if (document.getElementById('address').value) {
                fields.Address = document.getElementById('address').value;
            }
            
            try {
                const response = await fetch(`https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/Contacts`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${AIRTABLE_PAT}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ records: [{ fields }] })
                });
                
                if (response.ok) {
                    alertDiv.className = 'alert alert-success';
                    alertDiv.style.display = 'block';
                    alertDiv.innerHTML = '‚úÖ Thank you! Your submission has been received and is pending review.';
                    document.getElementById('submitForm').reset();
                } else {
                    const error = await response.json();
                    throw new Error(error.message || 'Submission failed');
                }
            } catch (error) {
                console.error('Error:', error);
                alertDiv.className = 'alert alert-error';
                alertDiv.style.display = 'block';
                alertDiv.innerHTML = '‚ùå Submission failed. Please try again or contact admin.';
            } finally {
                // Reset button state
                submitBtn.disabled = false;
                btnText.textContent = 'Submit for Review';
                spinner.style.display = 'none';
            }
        });
    </script>
</body>
</html>