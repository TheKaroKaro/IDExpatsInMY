<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Add Service - IndoMY Community</title>
<style>
  :root { --primary:#FF6B6B; --secondary:#4ECDC4; --dark:#2C3E50; --light:#F7F9FC; }
  body{ font-family:'Inter',system-ui; background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); min-height:100vh; }
  .form-container{ max-width:640px; margin:2rem auto; background:#fff; border-radius:30px; padding:2rem; box-shadow:0 20px 60px rgba(0,0,0,.3); }
  .honeypot{ display:none; }
  .form-header{ text-align:center; margin-bottom:1.5rem; }
  .form-header h1{ color:var(--primary); font-size:2rem; }
  .form-group{ margin-bottom:1rem; }
  .form-group label{ display:block; margin-bottom:.5rem; font-weight:600; color:var(--dark); }
  .form-control{ width:100%; padding:1rem; border:2px solid #e0e0e0; border-radius:15px; transition:.3s; font-size:1rem; }
  .form-control:focus{ border-color:var(--primary); outline:none; box-shadow:0 0 0 3px rgba(255,107,107,.1); }
  .btn-submit{ background:linear-gradient(135deg,var(--primary),#ff8e8e); color:#fff; border:none; padding:1rem 2rem; border-radius:50px; font-size:1.1rem; font-weight:600; cursor:pointer; width:100%; }
  .alert{ padding:1rem; border-radius:15px; margin-bottom:1rem; display:none; }
  .alert-success{ background:#d4edda; color:#155724; border-left:5px solid #2ecc71; }
  .alert-error{ background:#f8d7da; color:#721c24; border-left:5px solid #e74c3c; }
</style>
</head>
<body>
  <div class="form-container">
    <div class="form-header">
      <h1>➕ Share a Service</h1>
      <p>Help fellow members find trusted services</p>
    </div>
    <div id="alert" class="alert"></div>

    <form id="submitForm">
      <!-- Honeypot -->
      <div class="honeypot">
        <label for="website">Leave this empty</label>
        <input type="text" id="website" name="website"/>
      </div>

      <div class="form-group">
        <label for="name">Service/Business Name *</label>
        <input type="text" id="name" class="form-control" required/>
      </div>

      <div class="form-group">
        <label for="category">Category *</label>
        <select id="category" class="form-control" required>
          <option value="">Select category</option>
          <option>Money Changer</option><option>Locksmith</option><option>Driver</option>
          <option>Car Rental</option><option>Restaurant</option><option>Grocery</option>
          <option>Travel Agent</option><option>Lawyer</option><option>Doctor</option>
          <option>Contractor</option><option>Cleaner</option><option>Other</option>
        </select>
      </div>

      <div class="form-group">
        <label for="phone">Phone Number *</label>
        <input type="tel" id="phone" class="form-control" required placeholder="e.g., +60 12-345 6789"/>
      </div>

      <div class="form-group">
        <label for="whatsapp">WhatsApp Number (Optional)</label>
        <input type="tel" id="whatsapp" class="form-control" placeholder="e.g., +60 12-345 6789"/>
      </div>

      <div class="form-group">
        <label for="area">Area (Optional)</label>
        <input type="text" id="area" class="form-control" placeholder="e.g., PJ, KL, Subang"/>
      </div>

      <div class="form-group">
        <label for="address">Address (Optional)</label>
        <textarea id="address" class="form-control" rows="3"></textarea>
      </div>

      <div class="form-group">
        <label for="description">Description *</label>
        <textarea id="description" class="form-control" required rows="4"></textarea>
      </div>

      <div class="form-group">
        <label for="submittedBy">Your Name *</label>
        <input type="text" id="submittedBy" class="form-control" required/>
      </div>

      <div class="form-group">
        <label>Anti-spam: What is 5 + 3? *</label>
        <input type="number" id="mathCheck" class="form-control" required/>
      </div>

      <!-- Cloudflare Turnstile (optional: set site key or leave empty) -->
      <div class="form-group">
        <div class="cf-turnstile" data-sitekey="YOUR_TURNSTILE_SITE_KEY"></div>
      </div>

      <button type="submit" class="btn-submit">Submit for Review</button>
    </form>
  </div>

  <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
  <script>
    function setAlert(type, msg) {
      const el = document.getElementById('alert');
      el.className = 'alert ' + (type === 'success' ? 'alert-success' : 'alert-error');
      el.textContent = msg;
      el.style.display = 'block';
    }

    document.getElementById('submitForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const hp = document.getElementById('website').value;
      if (hp) return; // honeypot

      const mathAnswer = parseInt(document.getElementById('mathCheck').value, 10);
      if (mathAnswer !== 8) return setAlert('error', '✖ Incorrect anti-spam answer.');

      const tokenEl = document.querySelector('input[name="cf-turnstile-response"]');
      const turnstileToken = tokenEl ? tokenEl.value : "";

      const fields = {
        Name: document.getElementById('name').value,
        Category: document.getElementById('category').value,
        Phone: document.getElementById('phone').value,
        WhatsApp: document.getElementById('whatsapp').value,
        Address: document.getElementById('address').value,
        Area: document.getElementById('area').value,
        Description: document.getElementById('description').value,
        SubmittedBy: document.getElementById('submittedBy').value
      };

      try {
        const res = await fetch('/api/contacts', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ fields, turnstileToken })
        });
        const data = await res.json();
        if (!res.ok) throw new Error(data.error || 'Submission failed');
        setAlert('success', '✅ Thank you! Your submission is pending review.');
        e.target.reset();
        if (window.turnstile) window.turnstile.reset();
      } catch (err) {
        setAlert('error', '✖ Submission failed. Please try again.');
        console.error(err);
      }
    });
  </script>
</body>
</html>