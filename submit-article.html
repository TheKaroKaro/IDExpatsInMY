<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Post Article - IndoMY</title>
<style>
  :root { --primary:#FF6B6B; --dark:#2C3E50; }
  body{ font-family:'Inter',system-ui; background:#f0f2f5; }
  .wrap{ max-width:800px; margin:2rem auto; background:#fff; padding:2rem; border-radius:20px; box-shadow:0 8px 30px rgba(0,0,0,.08); }
  .form-group{ margin:1rem 0; }
  label{ font-weight:600; display:block; margin-bottom:.5rem; color:var(--dark); }
  .form-control{ width:100%; padding:.9rem; border:1px solid #ddd; border-radius:10px; }
  textarea.form-control{ min-height:200px; }
  .btn{ background:var(--primary); color:#fff; padding:.8rem 1.4rem; border:none; border-radius:10px; cursor:pointer; }
  .alert{ display:none; padding:1rem; border-radius:10px; margin:1rem 0; }
  .alert-success{ background:#d4edda; color:#155724; }
  .alert-error{ background:#f8d7da; color:#721c24; }
</style>
</head>
<body>
  <div class="wrap">
    <h1>üìù Post an Article</h1>
    <p>Articles are published after admin approval.</p>
    <div id="alert" class="alert"></div>

    <form id="articleForm">
      <div style="display:none">
        <label>Leave empty</label><input type="text" id="hp"/>
      </div>

      <div class="form-group">
        <label>Title *</label>
        <input class="form-control" id="title" required/>
      </div>
      <div class="form-group">
        <label>Content *</label>
        <textarea class="form-control" id="content" required></textarea>
      </div>
      <div class="form-group">
        <label>Author</label>
        <input class="form-control" id="author"/>
      </div>
      <div class="form-group">
        <label>Category</label>
        <input class="form-control" id="category"/>
      </div>
      <div class="form-group">
        <label>Image URL</label>
        <input class="form-control" id="image"/>
      </div>

      <div class="form-group">
        <div class="cf-turnstile" data-sitekey="YOUR_TURNSTILE_SITE_KEY"></div>
      </div>

      <button class="btn" type="submit">Submit for Review</button>
    </form>
  </div>

  <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
  <script>
    function alertBox(type, msg){
      const el = document.getElementById('alert');
      el.className = 'alert ' + (type === 'success' ? 'alert-success':'alert-error');
      el.textContent = msg; el.style.display = 'block';
    }
    document.getElementById('articleForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      if (document.getElementById('hp').value) return;
      const tokenEl = document.querySelector('input[name="cf-turnstile-response"]');
      const turnstileToken = tokenEl ? tokenEl.value : "";

      const fields = {
        Title: document.getElementById('title').value,
        Content: document.getElementById('content').value,
        Author: document.getElementById('author').value,
        Category: document.getElementById('category').value,
        ImageURL: document.getElementById('image').value
      };
      try {
        const res = await fetch('/api/articles', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ fields, turnstileToken }) });
        const data = await res.json();
        if (!res.ok) throw new Error(data.error || 'Failed');
        alertBox('success', '‚úÖ Submitted. Pending approval.');
        e.target.reset();
        if (window.turnstile) window.turnstile.reset();
      } catch(err) {
        alertBox('error', '‚úñ Submission failed.');
        console.error(err);
      }
    });
  </script>
</body>
</html>